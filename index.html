<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–∏—Å—å–º–æ</title>
  <link rel="stylesheet" href="settings.css" />
</head>
<body class="stage-1">
  <div class="hint no-select" id="hint">–ù–∞–∂–º–∏ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç ‚úâÔ∏è</div>
  <div class="scene">
      <div class="envelope-wrap" id="envelope" role="button" aria-label="–ö–æ–Ω–≤–µ—Ä—Ç">
        <div class="shell shell-back" id="shell" aria-hidden="true">
          <div class="env"></div>
          <div class="flap"></div>
        </div>

        <!-- –ü–∏—Å—å–º–æ –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –∫–æ–Ω–≤–µ—Ä—Ç –º–æ–≥ —É–ª–µ—Ç–∞—Ç—å -->
        <div class="letter" id="letter" role="button" aria-label="–õ–∏—Å—Ç">
          <div class="fold"></div>
          <div class="letter-inner" id="letterInner">
            <p class="letter-text" id="letterText"></p>
          </div>
        </div>
        <div class="shell shell-front" aria-hidden="true">
          <div class="front-left"></div>
          <div class="front-right"></div>
          <div class="front-bottom"></div>

          <div class="seal" id="seal">
            <span class="crack" aria-hidden="true"></span>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </div>
        </div>

      </div>
  </div>
  <script>
    // –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞
    const LETTER_TEXT =
`
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –Æ–ª–µ—á–∫–∞!

–ï—Å–ª–∏ —Ç—ã —ç—Ç–æ —á–∏—Ç–∞–µ—à—å, —Ç–æ –º–æ–≥—É —Ç–µ–±—è –ø–æ–∑–¥—Ä–∞–≤–∏—Ç—å ‚Äî —Ç—ã –ø–æ–ª—É—á–∏–ª–∞ –ø–∏—Å—å–º–æ –ª—é–±–≤–∏!
–Ø —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å —Ç–µ–±–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –∫—Ä–∞—Å–∏–≤–∞—è, –¥–æ–±—Ä–∞—è, –≤–µ—Å—ë–ª–∞—è, —Å–Ω–æ–≥—Å—à–∏–±–∞—Ç–µ–ª—å–Ω–∞—è!
–¢—ã –∏–¥–µ–∞–ª—å–Ω–∞ –≤–æ –≤—Å—ë–º, —É —Ç–µ–±—è –Ω–µ—Ç –º–∏–Ω—É—Å–æ–≤ ‚Äî —Ç—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–ª–µ—Å—Ç—å!
–Ø –¥–æ –±–µ–∑—É–º–∏—è —Ä–∞–¥, —á—Ç–æ –º—ã –Ω–∞—à–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∏ —Å—á–∞—Å—Ç–ª–∏–≤, —á—Ç–æ —É –Ω–∞—Å –≤—Å—ë –∏–¥—ë—Ç –∫ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º!
–Ø –æ–±–æ–∂–∞—é –≤—Å—ë: —Ç–≤–æ–π –∑–∞–ø–∞—Ö, —Ç–≤–æ—é —É–ª—ã–±–∫—É, —Ç–≤–æ–∏ –≥–ª–∞–∑–∞, —Ç–≤–æ—é –¥—É—à—É!
–î–∞ —á—Ç–æ —É–∂ —Ç–∞–º ‚Äî —è –ø—Ä–æ—Å—Ç–æ —Ç–µ–±—è –æ–±–æ–∂–∞—é!
–Ø –≤–µ—Ä—é, —á—Ç–æ —É –Ω–∞—Å —Å —Ç–æ–±–æ–π –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è, –≤—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ, –∏ –º—ã –±—É–¥–µ–º –≤–º–µ—Å—Ç–µ!
–Ø —Å –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∂–¥—É —Ç–≤–æ–∏—Ö —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã—Ö —á—É–≤—Å—Ç–≤ –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ç–≤–æ–µ–≥–æ —Å—Ç—Ä–∞—Ö–∞.
–Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –º–Ω–µ –≤–µ—Ä–∏–ª–∞ –∏ –¥–æ–≤–µ—Ä—è–ª–∞, –≤–µ–¥—å –±–µ–∑ —ç—Ç–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Äî –Ω–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è!
–Ø –≥–æ—Ç–æ–≤ –Ω–∞ –≤—Å—ë: –∂–¥–∞—Ç—å, –¥–æ–≤–µ—Ä—è—Ç—å, –ª—é–±–∏—Ç—å!
–Ø –≤–µ—Ä—é –≤ –Ω–∞—à–µ –±—É–¥—É—â–µ–µ –∏ –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ —Ç—ã —Ç–æ–∂–µ!

–° –ª—é–±–æ–≤—å—é, —Ç–≤–æ–π –î–µ–Ω–∏—Å! ü§ç
`;

    document.getElementById("letterText").textContent = LETTER_TEXT;

    const body = document.body;
    const envelope = document.getElementById("envelope");
    const letter = document.getElementById("letter");
    const hint = document.getElementById("hint");
    const letterInner = document.getElementById("letterInner");

    function fitLetterToViewport() {
      if (!letter || !letterInner) return;
      if (!body.classList.contains("stage-4")) return;

      letter.style.setProperty("--letter-scale", "1");

      const available = letter.clientHeight - 28;
      const needed = letterInner.scrollHeight;
      if (available <= 0 || needed <= 0) return;

      const scale = Math.max(0.75, Math.min(1, available / needed));
      letter.style.setProperty("--letter-scale", String(scale));
    }

    let stage = 1;

    envelope.addEventListener("click", (e) => {
      if (e.target.closest("#letter") && stage === 1) return;

      if (stage === 1) {
        stage = 2;
        body.classList.remove("stage-1");
        body.classList.add("stage-2");
        hint.textContent = "\u041f\u0435\u0447\u0430\u0442\u044c \u0441\u043d\u044f\u0442\u0430 \u2014 \u043f\u0438\u0441\u044c\u043c\u043e \u0432\u043d\u0443\u0442\u0440\u0438";
        return;
      }

      if (stage === 2) {
        stage = 3;
        body.classList.remove("stage-2");
        body.classList.add("stage-3");
        hint.textContent = "\u0412\u044b\u0442\u0430\u0449\u0438 \u043f\u0438\u0441\u044c\u043c\u043e";
        return;
      }
    });

    letter.addEventListener("click", (e) => {
      e.stopPropagation();
      if (stage === 2) {
        stage = 3;
        body.classList.remove("stage-2");
        body.classList.add("stage-3");
        hint.textContent = "\u0412\u044b\u0442\u0430\u0449\u0438 \u043f\u0438\u0441\u044c\u043c\u043e";
        return;
      }

      if (stage === 3) {
        stage = 4;
        body.classList.remove("stage-3");
        body.classList.add("stage-4");
        hint.textContent = "\u041e\u0442\u043a\u0440\u043e\u0439 \u043f\u0438\u0441\u044c\u043c\u043e";
        requestAnimationFrame(() => requestAnimationFrame(fitLetterToViewport));
      }
    });

    window.addEventListener("resize", () => {
      if (stage === 4) fitLetterToViewport();
    });

  </script>
</body>
</html>
